<!DOCTYPE html>
<html>

  <head>
  <title>PromilleRechner</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
  <div class = "body-wrapper">
    <header id="myHeader" class = "header-container">
        <h1>Don't Drink and Drive - Promille Rechner</h1>
        <nav id="main-nav">
            <div id ="nav" class="main-nav-ul">
                <button id="ibtn" class="link-btn"><a href="#info">Info</a></button>
                <button id="bbtn" class="link-btn"><a href ="#berechnen">Berechnen</a></button>
                <button id="ebtn" class="link-btn"><a href="#ergebnis">Ergebnis</a></button>
            </div>
        </nav>
    </header>
    <section id="info" class="info-container">
        <nav id="info-nav">
            <ul class="info-nav-ul">
                <li ><a href="#erklärung">Warum Promille rechner?</a></li>
                <li><a href="#mathe-beruendung">Wie Promille rechnen?</a></li>
            </ul>
        </nav>
        <div class="info-inhalt-container">
            <section id="erklärung">
                <h3>Was ist ein Promille-Rechner? </h3>
                <p>
                    Ein Promille steht für das Verhältnis 1:1000 und wird hauptsächlich in Verbindung mit Alkoholkonsum
                    verwendet. Grundsätzlich kann man sagen, dass 1 Promille 1 Gramm Alkohol in 1 Kilogramm Blut gleicht.</br>
                    Der Promille-Rechner berechnet unter Berücksichtigung von Geschlecht, Koerpergroesse und -gewicht, Alter,
                    Trink-Start und -Ende und dem Alkoholgehalt der getrunkenen Getränke den Promille-Anteil im Blut des
                    Konsumenten. </p>
                    Die Berechnungen auf dieser Seite sollen dazu Beitragen ein besseres Verständnis für Alkohol und seine
                    Auswirkungen auf den Menschlichen Körper zu erlangen.
                </p>
            </section>

            <section id="mathe-beruendungg">
                <h3>Wie wird der Promillegehalt berechnet? </h3>
                <p>
                  Unsere Berechnung erfolgt mithilfe der Watson-Formel. Die Formel lautet: </p></p>
                  Blutalkoholkonzentration (BAK) Männer = (0,8 x [Alkoholmenge in Gramm]) / (1,055 x (2.447 - 0.09516 x
                  [Alter in Jahren] + 0.1074 x [Größe in cm] + 0.3362 x [Koerpergewicht in kg]))</p></p>
                  Blutalkoholkonzentration (BAK) Frauen = (0,8 x [Alkoholmenge in Gramm]) / (1,055 x (-2.097+0.1069 x
                  [Größe in cm] + 0.2466 x [Koerpergewicht in kg]))</p></p>
                  Für ein genaueres Ergebnis wird der Beginn und das Ende des Alkoholkonsums berücksichtigt. Aus dem Ergebnis wird
                  ein Graph erstellt, der den ungefähren Alkoholspiegel im Konsumzeitraum wiederspiegelt.
                </p>
            </section>
            <div>
    </section>

    <section id="berechnen" class="berechnen-container">
            <div class="person-daten">
                <h4> Angabe zur Person </h4>
                <p>Geschlecht:<p>
                     <select id ="geschlecht" name="geschlecht">
            <option value ="weiblich">weiblich</option>
            <option value ="männlich">männlich</option>
          </select>
          <p>Koerpergroesse in cm:</p>
          <input id ="groesse" type = "number" min="70" max="300" value= "175"/>
          <p>Koerpergewicht in kg:</p>
          <input id ="gewicht" type = "number" min="30" max="400" value="70"/>
          <p>Alter in J:</p>
          <input id ="alter" type = "number" min="10" max="150" value= "45"/>
            </div>
            <div class="zeit-daten">
                <h4>Zeitangaben</h4>
                    <p>Trink-Start:</p>
                    <input id="anfang" type="time" name="start" value="20:00:00">
                    <p>Trink-Ende:</p>
                    <input id ="ende" type="time" name="ende" value="00:00:00">
            </div>
            <div id="duplication_model" class="drinks-daten-container">
                    <div class="drinks-header">
                        <h4>Konsumierte Getränke</h4>
                    </div>
                    <div id="drinks-listen0" class="drinks-listen-container">
                        <div id="drinks-liste" class="drinks-liste-container">
                          <p id="getraenkNr">Getränk:</p>
                          <select id="getraenkeListe" size="5">
                          <option value="0.016" id="Radler">Radler: 0,016 gramm pro ml</option>
                            <option value="0.04" id="Bier">Bier: 0,04 gramm pro ml</option>
                            <option value="0.064" id="Starkbier">Starkbier: 0,064 gramm pro ml</option>
                            <option value="0.048" id="Most">Most: 0,048 gramm pro ml</option>
                            <option value="0.104" id="Sekt">Sekt: 0,104 gramm pro ml</option>
                            <option value="0.088" id="Weißwein">Weißwein: 0,088 gramm pro ml</option>
                            <option value="1" id="Rotwein">Rotwein: 1 gramm pro ml</option>
                            <option value="0.064" id="Met">Met: 0,064 gramm pro ml</option>
                            <option value="0.16" id="Likör">Likör: 0,16 gramm pro ml</option>
                            <option value="0.255" id="Korn">Korn: 0,255 gramm pro ml</option>
                            <option value="0.32" id="Barcadi">Barcadi: 0,32 gramm pro ml</option>
                            <option value="0.64" id="Rum">Rum: 0,64 gramm pro ml</option>
                            <option value="0.34" id="Obstbrand">Obstbrand: 0,34 gramm pro ml</option>
                            </select>
                        </div>
                        <div id="mengenAngabe" class="mengen-container">
                            <label class ="menge-label">Menge:</label>
                            <input id="menge" type="number" min="0" value="0"class="menge-container"/>
                            <select id="metrik" name="metrik" class="metrik-container">
                                <option value="ml" id="ml">ml</option>
                                <option value="cl" id="cl">cl</option>
                                <option id="l" value="l">l</option>
                           </select>
                        </div>
                    </div>
                  </div>
                    <div class="input-dialog">
                    <div class="plusGetraenk-container">
                      <button class= "input-button" id="plusGetraenk" onclick="duplicate()">+ Getränk</button>
                    </div>
                    <div class="submit-dialog">
                      <label id="checkBoxLabel">
                        <input type="checkbox" id ="checkDisclaimar" name="readDisclamar" value="Read"/>
                        Ich stimme zu, dass die Informationen dieser Website
                        keinen falls dazu verwendet werden können,um zu
                        entscheiden ob jemand noch in der Lage ist ein
                        Fahrzeug zu führen oder nicht.
                        </br>
                        </label>
                        <button class = "input-button" id="berechneDaten" onclick="validate()"><a href="#ergebnis">Berechnen</a></button>
                     </div>

            </div>
          </section>
    <section id="ergebnis" class="ergebnis-container">
    <div class="chart1">
      <figure>
        <figcaption>
          Alkohl in g pro 500ml in Abhängigkeit von der Sorte.
        </figcaption>

        <div class="buttons"></div>
        <svg width="200" height="200" class="chart">
        <circle r="50" cx="100" cy="100" class="pie"/>
        </svg>
        </figure>
      </div>
        <div class="chart2">
          <figure>
            <figcaption>
              Dein Alkoholpegel und die lt.österreichischem Gesetz strafbaren Grenzen
            </figcaption>
            <svg id="svg2" width='100%' height='80px' viewBox='0 0 1130 80'>
            <g class='bars'>
              <rect fill='#ccc' width='100%' height='50'></rect>
              <rect id ="graphBAK"></rect>
            </g>
            <g class='markers'>
              <rect fill='#001f3f' x='0%' y='0' width='2px' height='60'></rect>
              <rect fill='#001f3f' x='5%' y='0' width='2px' height='60'></rect>
              <rect fill='#001f3f' x='10%' y='0' width='2px' height='60'></rect>
              <rect fill='#001f3f' x='15.8%' y='0' width='2px' height='60'></rect>
              <rect fill='#001f3f' x='23.8%' y='0' width='2px' height='60'></rect>
              <rect fill='#001f3f' x='31.8%' y='0' width='2px' height='60'></rect>
              <rect text-anchor='' fill='#001f3f' x='180%' y='0' width='2px' height='60'></rect>
            </g>
            <g>
              <text  x='0%' y='80'>0</text>
              <text  x='5%' y='80'>0.1</text>
              <text  x='10%' y='80'>0.5</text>
              <text  x='15.8%' y='80'>0.79</text>
              <text  x='23.8%' y='80'>1.19</text>
              <text  x='31.8%' y='80'>1.59</text>
            </g>
            </svg>

            </figure>
            <div class= "table1">
              <table>
                <tr>
                <th>Promille Grenzen</th>
                <th>Information</th>
                </tr>
                <tr>
                  <td>0.5...0.79</td>
                  <td><p>Gilt nur für Probeführerschein-Besitzer sowie Lkw- und Busfahrer.</p></td>
                </tr>
                <tr>
                  <td>0.8...1.19</td>
                  <td><p>Strafe von 800€ bis 3.700€. Bei erstem Vergehen 1 Monat Führerscheinentzug.
                    Bei Wiederholung min. 3 Monate.</p></td>
                </tr>
                <tr>
                  <td>1.20...1.59</td>
                  <td><p>Strafe von 1.200€ bis 4.400€. Mindestens 4 Monate Führerscheinentzug.
                    Bei Wiederholung min. 3 Monate</p></td>
                </tr>
                <tr>
                  <td>ab 1.60</td>
                  <td><p>Strafe von 1.600€ bis 5.900€. Mindestens 6 Monate Führerscheinentzug.
                    Nachschulung und zusätzliche Kosten von ca 863€, Amtsarzt und verkehrpsychologische Untersuchung.</p></td>
                </tr>
              </table>
            <a href="https://www.oeamtc.at/thema/vorschriften-strafen/alkohol-am-steuer-was-alkoholisierten-lenkern-bluehen-kann-16179524">Quelle: Oamtc Vorschriften-Strafen Alkohol Am Steuer</a>
        </div>
        </div>

      </section>

  </div>
  <script>
  var total = 573,
      buttons = document.querySelector('.buttons'),
      pie = document.querySelector('.pie'),
      activeClass = 'active';

  var continents = {
    bier: 20,
    weisswein : 22,
    rotwein: 25,
    sekt: 26,
    barcadi: 160,
    rum: 320
  };

  // work out percentage as a result of total
  var numberFixer = function(num){
    var result = ((num * total) / 1000);
    return result;
  }

  // create a button for each country
  for(property in continents){
    var newEl = document.createElement('button');
    newEl.innerText = property;
    newEl.setAttribute('data-name', property);
    buttons.appendChild(newEl);
  }

  // when you click a button setPieChart and setActiveClass
    buttons.addEventListener('click', function(e){
      if(e.target != e.currentTarget){
        var el = e.target,
            name = el.getAttribute('data-name');
        setPieChart(name);
        setActiveClass(el);
      }
      e.stopPropagation();
    });

  var setPieChart = function(name){
    var number = continents[name],
        fixedNumber = numberFixer(number),
        result = fixedNumber + ' ' + total;

    pie.style.strokeDasharray = result;
  }

  var setActiveClass = function(el) {
    for(var i = 0; i < buttons.children.length; i++) {
      buttons.children[i].classList.remove(activeClass);
      el.classList.add(activeClass);
    }
  }

  // Set up default settings
  setPieChart('bier');
  setActiveClass(buttons.children[0]);

  //-----------------------------///
  var Geschlecht = document.getElementById("geschlecht").value;
  var Koerpergroesse = document.getElementById("groesse").value;
  var Koerpergewicht = document.getElementById("gewicht").value;
  var Alter = document.getElementById("alter").value;
  // var Trinkstart = document.getElementById("anfang").innerHTML;
  // var Trinkende = document.getElementById("ende").innerHTML;
  var Getränke_Liste_Array = new Array();   //Alle ausgewählten Getränke in einer Liste
  var A = 0;
  var GKW = 0
  var A_neu = 0;

  var newId = 0;
  var clone;
  var BAK;



  function duplicate(){
    let clone = document.querySelector('#drinks-listen0').cloneNode(true);
    clone.setAttribute( 'drinks-listen', ++newId );

    document.querySelector('#duplication_model').appendChild( clone );

  }

  function validate(){
   is_checked();

   getA();  //Alkoholgehalt in gramm berechnen
   berechne();
  }


  function is_checked(){
    var Checkbox =  document.getElementById("checkDisclaimar");
    if (Checkbox.checked == false){
      alert('Bitte Verifiziern Sie, dass der Hinweis gelesen wurde, um Ergebnis zu erhalten!');
      exit();
    }
  }
  // Berechnungen

  function berechne(){
    if(Geschlecht == "weiblich"){
      berechne_GKW_Frau();
    }
    if(Geschlecht == "männlich"){
      berechne_GKW_Mann();
    }


   berechne_BAK();
   // var BAK_Restalkohol = berechne_aktuellen_Bak_Wert(BAK_Anfangswert);


   alert("BAK: " + BAK);
  }
    //Berechnung der Tatsächlichen Werte nach dem Trinken
  function berechne_GKW_Frau(){
    GKW = 1.055 * (-2.097 + 0.1069 * Koerpergroesse + 0.2466 * Koerpergewicht);
  }

  function berechne_GKW_Mann(){
    GKW = 1.055 *(2.447 - 0.09516 * Alter + 0.1074 * Koerpergroesse + 0.3362 * Koerpergewicht);

  }


  //Für Männer ergibt sich ein BAK: (0,8 x Alokoholgehalt in gramm) / (1,055 x (2.447 - 0.09516 x Alter + 0.1074 x Koerpergroesse + 0.3362 x Koerpergewicht)) = xxxx Promille
  //Für Frauen ergibt sich ein BAK: (0,8 x Alokoholgehalt in gramm) / (1,055 x (-2.097+0.1069 x Koerpergroesse + 0.2466 x Koerpergewicht)) = xxx Promille


  function berechne_BAK(){
    BAK = (0.8 * A) / GKW;
    setGraphBAK();
  }

  function setGraphBAK(){
  document.getElementById("graphBAK").setAttribute('fill','#333333');
  document.getElementById("graphBAK").setAttribute('height','50');
  document.getElementById("graphBAK").setAttribute('width', BAK*2*100);
  }


  function getA(){

    let alkoholgehalt = document.querySelectorAll('#getraenkeListe');
    let metrik = document.querySelectorAll('#metrik');
    let menge = document.querySelectorAll('#menge');


   for(var i = 0; i < metrik.length; i++){
     berechne_A(alkoholgehalt[i].id,alkoholgehalt[i].value,metrik[i].value,menge[i].value, i);
     A +=  A_neu;
   }

  alert("all drinks alkoholgehalt in Gramm: " + A);

  }

  function berechne_A(Alkoholsorte, alkoholgehalt, metrik, menge , i){
    alert("alkoholgehalt in Gramm: " + alkoholgehalt);
    alert("metrik: " + metrik);
    alert("Gewählte menge: " + menge);


     if(metrik == "cl"){
       menge = menge * 10;
     }
     if(metrik == "l"){
       menge = menge * 1000;
     }
     alert ("Menge in ml: " + menge);
     A_neu = menge * alkoholgehalt;
     Getränke_Liste_Array[i] = new Array(Alkoholsorte, alkoholgehalt, menge, A_neu);
     //A_neu ist alk-gehalt aufgerechnet auf die Menge

  }

  </script>


  <footer>
    <p>Webdesign by DJS, &copy Gruppe 6 WS19/20</p>
  </footer>
</body>

</html>
